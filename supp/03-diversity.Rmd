# Composition & Diversity

This analysis of assemblage diversity is limited to Caddo mortuary contexts at the Mounds Plantation, George C. Davis, and Gahagan Mound sites where Gahagan bifaces were recovered.

## Taxonomic composition

```{r composistion}
library(here)
library(dplyr)
# read data
data <- read.csv("gahagan-diagnostics.csv")

# table of diagnostics
knitr::kable(data)
```

## Alpha diversity

```{r diversity, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
library(vegan)

# assemblage size (N)
N <- rowSums(data[3:15])
N ## assemblage sizes range from:

# how many of each type were found?
T <- colSums(data[3:15])
T

## richness (S) = number of types in assemblage
S <- specnumber(data[3:15])
S

## ubiquity (U) = number of assemblages that contain a particular type
U <- specnumber(data[3:15])
U
```

## Relative abundance

```{r relative.abundance}
# mean number of observations for each type
colMeans(data[3:15])

# data by percentage
data.pct <- data[3:15]/N*100
## mean percent (Mp) of each type across assemblage
Mp <- colMeans(data.pct)
Mp

## percentage of sites that have each type
Up <- U/length(N)*100
Up
```

### Relative abundance by context

```{r plot.alpha.diversity, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Contexts ordered temporally from bottom to top based upon seriation results provided in the previous chapter. The middle two contexts (16RR1-BP2 and 16CD12-BP5) are interchangeable."}
library(dplyr)
library(ggplot2)
library(wesanderson)

pal <- wes_palette("Moonrise2", 13, type = "continuous")

gahagan_ct <- data[, -(1:2)]
labels <- paste0(data$context, " (", substr(data$region, 1, 1), ")")
rownames(gahagan_ct) <- labels

artifacts_long <- data.frame(context = rownames(gahagan_ct), 
                             stack(as.data.frame(gahagan_ct)))

artifacts <- rename(artifacts_long, Types = ind)

# configure plot
plot1 <- artifacts %>% 
  arrange(context) %>% 
  mutate(context = factor(context, levels = c(
                            "16CD12-BP1 (N)", "41CE19-F134 (S)", "16RR1-BP3 (S)",
                            "16CD12-BP5 (N)", "16RR1-BP2 (S)", "41CE19-F119 (S)", 
                            "16CD12-BP2 (N)", "16CD12-BP8 (N)"))) %>% 
  ggplot( aes(x=context, y = values, fill = Types)) + 
  geom_bar(stat="identity", position = "fill") + 
  coord_flip() +
  scale_fill_manual(values = pal) +
  labs(x = "Context",
       y = "Relative abundance (%)",
       title = "Abundance of diagnostic types across Gahagan-bearing contexts")

## print
plot1
```

## Diversity indices

```{r diversity.indices, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# Shannon diversity
## high diversity = more types and spread more evenly over types
data$H <- diversity(data[3:15])
H <- data$H
```

## Evenness

```{r even, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# evenness
## Pielou's J (Shannon diversity index divided by natural log of richness)
J <- H/log(S)
J
```

## Beta diversity

```{r diversity2, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Caddo burial assemblages that include Gahagan bifaces; 1, 41CE19-F134; 2, 41CE19-F119; 3, 16RR1-BP2; 4, 16RR1-BP3; 5, 16CD12-BP1; 6, 16CD12-BP2; 7, 16CD12-BP5; 8, 16CD12-BP8. The three sites in the lower part of the left quadrat exhibit lower diversity and evenness, and each represents the earliest context at each site to include a Gahagan biface. Those sites in the upper right quadrat have higher diversity and evenness, and occur later than those in the lower left quadrat."}
# summarize assemblage diversity to identify high & low diversity assemblages
library(maptools)
pch <- c(1, 3)[as.factor(data$region)]
plot(H, J, 
     pch = pch)
abline(h = median(J), 
       v = median(H), 
       lty = 2)
pointLabel(H, J, 
           rownames(data), 
           cex = .75)
leg.txt <- c(as.expression(bquote("Northern Behavioral Region")), 
             as.expression(bquote("Southern Behavioral Region")))
legend("bottomright", 
       leg.txt, 
       pch = c(1, 3))
```

### Beta diversity - Northern Behavioural Region

```{r shannon.nbr.context, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# filter dataset by nbr context
# mutate to add temporal assignment per seriation
nbr <- data %>% 
  filter(context == c("16CD12-BP1", "16CD12-BP2", 
                      "16CD12-BP5", "16CD12-BP8")) %>% 
  mutate(temporal = c(1, 3, 2, 4), .after = region)

pal2 <- wes_palette("Moonrise2", 4, type = "continuous")

# table of diagnostics
knitr::kable(nbr, "pipe")

nbr.H <- nbr$H
nbr.temporal <- nbr$temporal

## plot
ggplot(nbr, aes(x = nbr.temporal, y = nbr.H)) +
  geom_point(aes(shape = factor(context))) +
  geom_smooth(method = "lm")

# load
library(RRPP)

# are data normally distributed?
shapiro.test(nbr.H)
hist(nbr.H, col='steelblue')

# ANOVA: differences in assemblage diversity among the contexts?

# MODEL: H as a function of context
nbr.shannon <- aov(nbr.H ~ nbr.temporal, data = nbr)
# ANOVA: do contexts differ by H?
summary(nbr.shannon)
```

### Beta diversity - Southern Behavioural Region

```{r shannon.sbr.context, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# filter dataset by sbr context
# mutate to add temporal assignment per seriation
sbr <- data %>% 
  filter(context == c("41CE19-F134", "41CE19-F119", "16RR1-BP2", "16RR1-BP3")) %>% 
  mutate(temporal = c(1, 2, 2, 1), .after = region)

# table of diagnostics
knitr::kable(sbr, "pipe")

sbr.H <- sbr$H
sbr.temporal <- sbr$temporal

## plot
ggplot(sbr, aes(x = sbr.temporal, y = sbr.H)) +
  geom_point(aes(shape = factor(context))) +
  geom_smooth(method = "lm")

# are data normally distributed?
shapiro.test(sbr.H)
hist(sbr.H, col='steelblue')

# ANOVA: differences in assemblage diversity among the contexts?
sbr.context <- sbr$context

# MODEL: H as a function of context
sbr.temporal.shannon <- aov(sbr.H ~ sbr.temporal, data = sbr)
# ANOVA: do contexts differ by H?
summary(sbr.temporal.shannon)
```

### Beta diversity - Temporal

Greater diversity in mortuary assemblage diversity after the initial internment that included a Gahagan biface?

```{r shannon.init.temporal, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# mutate to add temporal assignment
temp <- data %>%
  mutate(temporal = c(1, 2, 2, 1, 1, 2, 2, 2), .after = region)

# table of diagnostics
knitr::kable(temp, "pipe")

temp.H <- temp$H
time <- temp$temporal

## plot
ggplot(temp, aes(x = time, y = temp.H)) +
  geom_point(aes(shape = factor(context))) +
  scale_shape_manual(values = c(0:5,15,17)) +
  geom_smooth(method = "lm")

# are data normally distributed?
shapiro.test(temp.H)
hist(temp.H, col='steelblue')

# ANOVA: differences in assemblage diversity among 
# initial v. later contexts?

# MODEL: H as a function of temporal contexts
temp.shannon <- aov(temp.H ~ time, data = temp)
# ANOVA: do temporal contexts differ by H?
summary(temp.shannon)
```
