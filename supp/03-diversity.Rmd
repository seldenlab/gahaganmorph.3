# Composition & Diversity

This analysis of assemblage diversity is limited to Caddo mortuary contexts at the Mounds Plantation, George C. Davis, and Gahagan Mound sites where Gahagan bifaces were recovered.

## Taxonomic composition

```{r composistion}
library(here)
library(tidyverse)
library(kableExtra)

# read data
data <- read.csv("gahagan-diversity.csv")

# table of diagnostics
knitr::kable(data) %>% 
  kable_styling() %>% 
  scroll_box(width = "100%", box_css = "border: 0px;")
```

## Alpha diversity

```{r diversity, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
library(vegan)

# assemblage size (N)
N <- rowSums(data[11:25])
N ## assemblage sizes range from:

# how many of each type were found?
T <- colSums(data[11:25])
T

## richness (S) = number of types in assemblage
S <- specnumber(data[11:25])
S

## ubiquity (U) = number of assemblages that contain a particular type
U <- specnumber(data[11:25])
U
```

## Relative abundance

```{r relative.abundance}
## mean number of observations for each type
colMeans(data[11:25])

# convert to percentage
data.pct <- data[11:25]/N*100
## mean percent (Mp) of each type across assemblage
Mp <- colMeans(data.pct)
Mp

## percentage of sites that have each type
Up <- U/length(N)*100
Up
```

### Relative abundance by context

```{r plot.burial.diversity, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Relative abundance of age and sex data associated with burials. For this undertaking, the term juvenile encompassess all non-adults. Contexts ordered temporally from bottom to top based upon seriation results provided in the previous chapter. Middle two contexts (16RR1-BP2 and 16CD12-BP5) are interchangeable."}
library(dplyr)
library(reshape)
library(ggplot2)
library(ggpubr)
library(ggExtra)
library(wesanderson)

# relative abundance of juvenile and adult burials
pal <- wes_palette("Moonrise2", 2, type = "continuous")

burials <- data %>% 
  select(context, total_adult, total_juvenile) %>% 
  mutate(context = paste(context, c("(S)", "(S)", "(S)", "(S)",
                                    "(N)", "(N)", "(N)", "(N)"))) %>% 
  melt(id.vars = "context")

# configure plot
plot1 <- burials %>%
  arrange(context) %>% 
  mutate(context = factor(context, levels = c(
                            "16CD12-BP1 (N)", "41CE19-F134 (S)", "16RR1-BP3 (S)",
                            "16CD12-BP5 (N)", "16RR1-BP2 (S)", "41CE19-F119 (S)", 
                            "16CD12-BP2 (N)", "16CD12-BP8 (N)"))) %>% 
  ggplot(aes(x=context, y = value, fill = variable)) + 
  geom_bar(stat="identity", position = "fill") + 
  coord_flip() +
  scale_fill_manual(values = pal) +
  labs(x = "Context",
       y = "Relative abundance (%)",
       fill = "Category")

# relative abundance of burials by category
pal <- wes_palette("Moonrise2", 6, type = "continuous")

burials <- data %>% 
  select(context, adult_male:uid_adult, juvenile_male:uid_juvenile) %>% 
  mutate(context = paste(context, c("(S)", "(S)", "(S)", "(S)",
                                    "(N)", "(N)", "(N)", "(N)"))) %>% 
  melt(id.vars = "context")

# configure plot
plot2 <- burials %>%
  arrange(context) %>% 
  mutate(context = factor(context, levels = c(
                            "16CD12-BP1 (N)", "41CE19-F134 (S)", "16RR1-BP3 (S)",
                            "16CD12-BP5 (N)", "16RR1-BP2 (S)", "41CE19-F119 (S)", 
                            "16CD12-BP2 (N)", "16CD12-BP8 (N)"))) %>% 
  ggplot(aes(x=context, y = value, fill = variable)) + 
  geom_bar(stat="identity", position = "fill") + 
  coord_flip() +
  scale_fill_manual(values = pal) +
  labs(x = "Context",
       y = "Relative abundance (%)",
       fill = "Category")

# render figure
figure <- ggarrange(plot1, plot2,
                      labels = c("a","b"),
                      ncol = 1, nrow = 2)

## plot figure
figure
```

```{r plot.alpha.diversity, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Relative abundance of associated diagnostics. Contexts ordered temporally from bottom to top based upon seriation results provided in the previous chapter. Middle two contexts (16RR1-BP2 and 16CD12-BP5) are interchangeable."}
# relative abundance of lithics + ceramics
pal <- wes_palette("Moonrise2", 2, type = "continuous")

cerlith <- data %>% 
  select(context, lithics, ceramics) %>% 
  mutate(context = paste(context, c("(S)", "(S)", "(S)", "(S)",
                                    "(N)", "(N)", "(N)", "(N)"))) %>% 
  melt(id.vars = "context")

# configure plot
plot3 <- cerlith %>%
  arrange(context) %>% 
  mutate(context = factor(context, levels = c(
                            "16CD12-BP1 (N)", "41CE19-F134 (S)", "16RR1-BP3 (S)",
                            "16CD12-BP5 (N)", "16RR1-BP2 (S)", "41CE19-F119 (S)", 
                            "16CD12-BP2 (N)", "16CD12-BP8 (N)"))) %>% 
  ggplot(aes(x=context, y = value, fill = variable)) + 
  geom_bar(stat="identity", position = "fill") + 
  coord_flip() +
  scale_fill_manual(values = pal) +
  labs(x = "Context",
       y = "Relative abundance (%)",
       fill = "Category")

# relative abundance of diagnostic types
pal <- wes_palette("Moonrise2", 17, type = "continuous")

diagnostics <- data %>% 
  select(context, alba:ceramic_bowl) %>% 
  mutate(context = paste(context, c("(S)", "(S)", "(S)", "(S)",
                                    "(N)", "(N)", "(N)", "(N)"))) %>% 
  melt(id.vars = "context")

# configure plot
plot4 <- diagnostics %>% 
  arrange(context) %>% 
  mutate(context = factor(context, levels = c(
                            "16CD12-BP1 (N)", "41CE19-F134 (S)", "16RR1-BP3 (S)",
                            "16CD12-BP5 (N)", "16RR1-BP2 (S)", "41CE19-F119 (S)", 
                            "16CD12-BP2 (N)", "16CD12-BP8 (N)"))) %>% 
  ggplot( aes(x=context, y = value, fill = variable)) + 
  geom_bar(stat="identity", position = "fill") + 
  coord_flip() +
  scale_fill_manual(values = pal) +
  labs(x = "Context",
       y = "Relative abundance (%)",
       fill = "Types") +
  theme(legend.key.height = unit(0.05, "cm"))

# render figure
figure <- ggarrange(plot3, plot4,
                      labels = c("c","d"),
                      ncol = 1, nrow = 2)

## plot figure
figure
```

## Diversity indices

```{r diversity.indices, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# diversity - diagnostics
# Simpson diversity
data$D1 <- diversity(data[11:25], index = "simpson")
D1 <- data$D1

# evenness - diagnostics
# Shannon diversity
data$H <- diversity(data[11:25])
H <- data$H

# Pielou's J (Shannon diversity index divided by natural log of richness)
data$J <- H/log(S)
J <- data$J
```

## Beta diversity - diagnostics

```{r diversity2, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap="Caddo burial assemblages that include Gahagan bifaces; 1, 41CE19-F134; 2, 41CE19-F119; 3, 16RR1-BP2; 4, 16RR1-BP3; 5, 16CD12-BP1; 6, 16CD12-BP2; 7, 16CD12-BP5; 8, 16CD12-BP8. The three sites in the lower part of the left quadrat exhibit lower diversity and evenness, and each represents the earliest context at each site to include a Gahagan biface. Those sites in the upper right quadrat have higher diversity and evenness, and occur later than those in the lower left quadrat."}

# summarize assemblage diversity to identify high & low diversity assemblages
ggplot(data, aes(x = D1, y = J, color = region,
                 shape = region, label = rownames(data))) +
  geom_text(aes(label = rownames(data))) +
  geom_vline(aes(xintercept = median(D1))) +
  geom_hline(aes(yintercept = median(J))) +
  theme(legend.position = c(0.87, 0.15)) +
  labs(color = "Behavioral Region")
```

## Diversity through time

**_Research question_: Does mortuary assemblage diversity increase through time?**

**_Hypothesis_: Caddo mortuary assemblages associated with Gahagan bifaces increase in diversity subsequent to their initial use as mortuary offerings.**

This hypothesis is tested using counts of attributes and associated diagnostic artefacts recovered from Caddo mortuary contexts at the Mounds Plantation, George C. Davis, and Gahagan Mounds site where Gahagan bifaces were included as part of the mortuary assemblage. The hypothesis assesses whether diagnostic material culture objects included with Caddo burials became more diverse and evenly distributed among the types as burial practices evolved.

```{r simpson.init.diversity, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# diversity
library(RRPP)

# mutate data to add temporal assignment
temp <- data %>%
  mutate(temporal = c(1, 2, 2, 1, 1, 2, 2, 2), .after = region)

# revised table of diagnostics
knitr::kable(temp) %>% 
  kable_styling() %>% 
  scroll_box(width = "100%", box_css = "border: 0px;")

# attributes for plots
temp.D1 <- temp$D1
temp.J <- temp$J
time <- temp$temporal

#diversity
## plot diversity
ggplot(temp, aes(x = time, y = temp.D1)) +
  geom_point(aes(shape = factor(context))) +
  scale_shape_manual(values = c(0:5,15,17)) +
  geom_smooth(method = "lm")

# are data not normally distributed?
shapiro.test(temp.D1)

## plot distribution
hist(temp.D1, col='steelblue')

# MODEL: temp.D1 as a function of time
temp.simpson <- lm.rrpp(temp.D1 ~ time,
                        data = temp,
                        print.progress = FALSE,
                        iter = 9999)

## ANOVA: increase in diversity through time?
anova(temp.simpson)
```

### Evenness through time

```{r simpson.init.evenness, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# evenness

## plot evenness
ggplot(temp, aes(x = time, y = temp.J)) +
  geom_point(aes(shape = factor(context))) +
  scale_shape_manual(values = c(0:5,15,17)) +
  geom_smooth(method = "lm")

# are data not normally distributed?
shapiro.test(temp.J)

## plot distribution
hist(temp.J, col='steelblue')

# MODEL: J as a function of initial v. later contexts
temporal.J <- anosim(temp.J, 
                     grouping = time, 
                     permutations = 10000)

## ANOSIM: do temporal contexts differ by J?
summary(temporal.J)
```
